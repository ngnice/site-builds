<p>什么是 Subject？在 RxJS 中，Subject 是一种特殊的 Observable 类型，它允许将值多播给多个观察者。普通的 Observable 是单播的（每一个订阅的观察者都拥有自己独立的执行环境），而 Subject 可以共享一个执行环境。</p>
<blockquote>
<p>Subject 是一种可以多播给多个观察者的 Observable。与 EventEmitter 类似：他们都维护着多个监听器的注册表。</p>
</blockquote>
<p>每一个 Subject 都是一个可观察对象。对于一个 Subject ，你可以订阅（<code>subscribe</code>）它，观察者将会正常接收到数据。从观察者的角度而言，它无法判断自己的执行环境是简单的 Observable 还是 Subject。</p>
<p>在 Subject 的内部，并不会在被订阅（<code>subscribe</code>）后创建新的执行环境。它仅会把给定的观察者注册在观察者列表中。这和其他语言或库中的 <code>addListener</code> 机制类似。</p>
<p>每一个 Subject 也可以作为观察者。它是一个含有 <code>next(v)</code>，<code>error(e)</code> 和 <code>complete()</code> 的对象，要给 Subject 提供新值，只需要调用 <code>next(theValue)</code> 方法，它会将值多播给所有监听该 Subject 的观察者们。</p>
<p>下面的例子中，我们在 Subject 上注册了两个 Observer ，并且多路推送了一些数值：</p>
<pre><code><div>import { Subject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>

<span class="token keyword">const</span> subject <span class="token operator">=</span> new Subject<span class="token operator">&lt;</span>number<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">2</span></div></code></pre><p>由于 Subject 是观察者，这也意味着你可以把它作为订阅（<code>subscribe</code>）任何可观察对象的参数，如下面例子所示：</p>
<pre><code><div>import { Subject<span class="token punctuation">,</span> from } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>

<span class="token keyword">const</span> subject <span class="token operator">=</span> new Subject<span class="token operator">&lt;</span>number<span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token keyword">const</span> observable <span class="token operator">=</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

observable<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token comment" spellcheck="true">; // 你可以传递 Subject 来订阅 observable</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">3</span></div></code></pre><p>通过上面的方法，我们基本上可以通过 Subject 将单播的 Observable 执行转换为多播。这说明了 Subject 是将任意的 Observable 执行共享给多个观察者唯一方法。</p>
<p>还有几种特殊的 Subject 类型，分别是 BehaviorSubject，ReplaySubject，和 AsyncSubject。</p>

        <h1 id="多播的observable" class="docs-header-link">
          <span header-link="多播的observable"></span>
          多播的Observable
        </h1>
      <p>一个 <code>multicasted Observable</code> 是通过一个含有多个订阅者的 Subject 来实现的。而普通的 <code>unicast Observable</code> 仅将通知发送给单个观察者。</p>
<blockquote>
<p>一个 multicasted Observable 在后台使用一个 Subject 来使多个 Observer 看到相同的 Observable 执行。</p>
</blockquote>
<p>在后台，multicast 是这样操作的：观察者订阅一个相关的 Subject，Subject 订阅一个 Observable 源。下面的示例与前面使用的 <code>observable.subscribe(subject):</code> 示例类似:</p>
<pre><code><div>import { from<span class="token punctuation">,</span> Subject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
import { multicast } from <span class="token string">'rxjs/operators'</span><span class="token comment" spellcheck="true">;</span>

<span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token function">from</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> multicasted <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">multicast</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 通过`subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>}<span class="token punctuation">)</span>`订阅Subject的Observer<span class="token punctuation">:</span>
multicasted<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
multicasted<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 让 Subject 从数据源订阅开始生效<span class="token punctuation">:</span>
multicasted<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span></div></code></pre><div class="dg-paragraph"><code>multicast</code> 方法返回一个类似于 Observable 的可观察对象，但是在其被订阅后，它会表现 Subject 的特性。<code>multicast</code> 返回一个 ConnectableObservable 对象，拥有 <code>connect()</code> 方法。</div>
<div class="dg-paragraph"><code>connect()</code> 方法非常重要，它决定 Observable 何时开始执行。因为 <code>connect()</code> 在后台调用 <code>source.subscribe(subject)</code> 之后，<code>connect()</code> 会返回一个 Subscription，供调用者来取消订阅，从而终止共享的 Observable 的执行。</div>

        <h2 id="引用计数" class="docs-header-link">
          <span header-link="引用计数"></span>
          引用计数
        </h2>
      <p>通过 <code>connect()</code> 手动调用和处理 Subscription 很麻烦。通常，我们希望在有第一个 Observer 订阅后自动连接，当最后一个 Observer 取消订阅后自动断开连接。</p>
<p>我们来分析一下下面例子中 subscription 的过程：</p>
<ol>
<li>第一个 Observer 订阅 multicasted Observable</li>
<li>multicasted Observable 连接</li>
<li>向第一个 Observer 发送值为0的 next 通知</li>
<li>第二个 Observer 订阅了多播的 Observable</li>
<li>向第一个 Observer 发送值为1的 next 通知</li>
<li>向第二个 Observer 发送值为1的 next 通知</li>
<li>第一个 Observer 取消了多播的 Observable 订阅</li>
<li>向第二个 Observer 发送值为2的 next 通知</li>
<li>第二个 Observer 取消了多播的 Observable 订阅</li>
<li>取消对多路推送的 Observable 的连接</li>
</ol>
<p>通过显式地调用 connect()，代码如下：</p>
<pre><code><div>import { interval<span class="token punctuation">,</span> Subject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
import { multicast } from <span class="token string">'rxjs/operators'</span><span class="token comment" spellcheck="true">;</span>

<span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> multicasted <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">multicast</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
let subscription1<span class="token punctuation">,</span> subscription2<span class="token punctuation">,</span> subscriptionConnect<span class="token comment" spellcheck="true">;</span>

subscription1 <span class="token operator">=</span> multicasted<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token operator">/</span><span class="token operator">/</span> 我们应该在这里调用 `<span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>`，
<span class="token operator">/</span><span class="token operator">/</span> 因为 multicasted 的第一个订阅者对使用值感兴趣
subscriptionConnect <span class="token operator">=</span> multicasted<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  subscription2 <span class="token operator">=</span> multicasted<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
    <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
  }<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
}<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  subscription1<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
}<span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 在此处应该取消共享的 Observable 执行，
<span class="token operator">/</span><span class="token operator">/</span> 因为在这之后 `multicasted` 就不再有订阅者了
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  subscription2<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
  subscriptionConnect<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">; // 取消订阅</span>
}<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span></div></code></pre><p>如果我们不想显式地调用 connect() 方法，我们可以使用 ConnectableObservable 的 <code>refCount()</code> 方法（reference counting）。它返回一个 Observable 来跟踪有多少个订阅者。当订阅者从0增加到1时，它会调用 <code>connect()</code> 方法。只有当订阅者从1变为0时，它才会完全取消订阅，终止进一步的执行。</p>
<blockquote>
<p>refCount 使得多播的 Observable 在被订阅后自动执行，在最后一个观察者取消订阅后，停止执行。</p>
</blockquote>
<p>下面是示例：</p>
<pre><code><div>import { interval<span class="token punctuation">,</span> Subject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
import { multicast<span class="token punctuation">,</span> refCount } from <span class="token string">'rxjs/operators'</span><span class="token comment" spellcheck="true">;</span>

<span class="token keyword">const</span> source <span class="token operator">=</span> <span class="token function">interval</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">Subject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> refCounted <span class="token operator">=</span> source<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token function">multicast</span><span class="token punctuation">(</span>subject<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">refCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
let subscription1<span class="token punctuation">,</span> subscription2<span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 调用 `<span class="token function">connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>`，因为它是 `refCounted` 的第一个订阅者
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'observerA subscribed'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subscription1 <span class="token operator">=</span> refCounted<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'observerB subscribed'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
  subscription2 <span class="token operator">=</span> refCounted<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
    <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
  }<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
}<span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'observerA unsubscribed'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
  subscription1<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
}<span class="token punctuation">,</span> <span class="token number">1200</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 此处共享的 Observable 执行将停止
<span class="token operator">/</span><span class="token operator">/</span> 因为在这之后 `refCounted` 将不再有订阅者
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'observerB unsubscribed'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
  subscription2<span class="token punctuation">.</span><span class="token function">unsubscribe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
}<span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA subscribed
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB subscribed
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA unsubscribed
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB unsubscribed</div></code></pre><p>只有 ConnectableObservables 拥有 <code>refCount()</code> 方法，调用后会返回一个 <code>Observable</code> 而不是新的 ConnectableObservable。</p>

        <h2 id="行为主题" class="docs-header-link">
          <span header-link="行为主题"></span>
          行为主题
        </h2>
      <div class="dg-paragraph"><code>BehaviorSubject</code> 是 Subject 的一个衍生类，具有“当前值”的概念。它保存向消费者发送的最新的值。当一个新的 Observer 订阅后，它都会立即从 <code>BehaviorSubject</code> 接收一个&quot;当前值&quot;。</div>
<blockquote>
<p>BehaviorSubjects 非常适于表示“随时间推移的值”。举例来说，Subject 表示生日，而 BehaviorSubject 表示人的年纪。（生日只是一天，一个人的年纪会保持到下一次生日之前。）</p>
</blockquote>
<p>下面例子中，展示了用0初始化 BehaviorSubject，当 Observer 订阅它时，0是第一个被推送的值。第二个 Observer 将会接收到2这个值，尽管它是在2被发送之后订阅的。</p>
<pre><code><div>import { BehaviorSubject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">BehaviorSubject</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">; // 初始化0</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">3</span></div></code></pre>
        <h2 id="重播主题" class="docs-header-link">
          <span header-link="重播主题"></span>
          重播主题
        </h2>
      <div class="dg-paragraph"><code>ReplaySubject</code> 与 <code>BehaviorSubject</code> 类似，它也可以向新的订阅者推送旧数值，但它也可以记录 Observable 执行的一部分状态。</div>
<blockquote>
<p>一个 ReplaySubject 可以记录 Observable 执行过程中推送的多个值，并向新的订阅者重播它们。</p>
</blockquote>
<p>当创建一个 <code>ReplaySubject</code> 时，你可以指定重播值的数量：</p>
<pre><code><div>import { ReplaySubject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">ReplaySubject</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">; // 重播数量：3</span>
subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">4</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">4</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">5</span></div></code></pre><p>除了缓冲区大小以外，还可以指定一个以毫秒为单位的窗口时间，以确定记录的值可以使用多长时间。下面的例子中，我们把缓冲区的值设置为100，但是窗口时间参数仅为500毫秒。</p>
<pre><code><div>import { ReplaySubject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">ReplaySubject</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">500</span> <span class="token operator">/</span><span class="token operator">*</span> windowTime <span class="token operator">*</span><span class="token operator">/</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

let i <span class="token operator">=</span> <span class="token number">1</span><span class="token comment" spellcheck="true">;</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token operator">+</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> {
  subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
    <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
  }<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
}<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">4</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">4</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">6</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">6</span>
<span class="token operator">/</span><span class="token operator">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></div></code></pre>
        <h2 id="异步主题" class="docs-header-link">
          <span header-link="异步主题"></span>
          异步主题
        </h2>
      <div class="dg-paragraph"><code>AsyncSubject</code> 是 Subject 的另外一个衍生类，Observable 仅会在执行完成后，推送执行环境中的最后一个值。</div>
<pre><code><div>import { AsyncSubject } from <span class="token string">'rxjs'</span><span class="token comment" spellcheck="true">;</span>
<span class="token keyword">const</span> subject <span class="token operator">=</span> new <span class="token function">AsyncSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerA<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span>{
  <span class="token keyword">next</span><span class="token punctuation">:</span> <span class="token punctuation">(</span>v<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>`observerB<span class="token punctuation">:</span> ${v}`<span class="token punctuation">)</span>
}<span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

subject<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>
subject<span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">;</span>

<span class="token operator">/</span><span class="token operator">/</span> 输出<span class="token punctuation">:</span>
<span class="token operator">/</span><span class="token operator">/</span> observerA<span class="token punctuation">:</span> <span class="token number">5</span>
<span class="token operator">/</span><span class="token operator">/</span> observerB<span class="token punctuation">:</span> <span class="token number">5</span></div></code></pre><p>AsyncSubject 与 <a target="_blank" href="https://rxjs.dev/api/operators/last">last()</a> 操作符相似，等待 <code>complete</code> 推送执行过程的最后一个值。</p>
